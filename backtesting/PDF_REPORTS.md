# PDF Report Generation

The backtesting framework now includes comprehensive PDF report generation using ReportLab. PDF reports are professionally formatted and ideal for presentations, documentation, and archival purposes.

## Features

### What's Included

The PDF report contains:

1. **Executive Summary**
   - Period (start/end dates)
   - Total trading days
   - Initial and final portfolio values
   - Total return

2. **Performance Metrics** (color-coded tables)
   - **Returns** (blue header): Total return, annualized return, CAGR, etc.
   - **Risk Metrics** (red header): Sharpe, Sortino, Calmar ratios, max drawdown, volatility
   - **Additional Metrics** (green header): Win rate, profit factor, skewness, kurtosis, etc.

3. **Performance Charts** (embedded high-quality images)
   - Cumulative returns
   - Drawdown analysis (underwater plot)
   - Rolling Sharpe ratio
   - Return distribution histogram
   - Portfolio exposures (gross/net)
   - Transaction costs over time
   - Factor attribution breakdown

4. **Detailed Statistics**
   - Number of trading days and months
   - Positive vs negative days with percentages
   - Average/median daily returns
   - Best and worst days
   - Average positive/negative returns
   - Total and average transaction costs

5. **Monthly Returns Table**
   - Month-by-month performance
   - Last 24 months displayed if history is long

6. **Professional Formatting**
   - Color-coded sections for easy navigation
   - Professional fonts and spacing
   - Page breaks for readability
   - Timestamp of report generation

## Usage

### Quick Start

```python
from backtesting import Backtester, BacktestConfig, DataManager

# ... run your backtest ...

# Generate PDF report with all charts
results.generate_full_report(
    output_dir='./output/my_backtest',
    formats=['pdf', 'html', 'excel', 'csv']
)

# PDF will be created at: ./output/my_backtest/backtest_report.pdf
```

### PDF Only

```python
# Generate just the PDF report
results.generate_pdf_report(
    output_path='./output/my_report.pdf',
    chart_dir='./output/charts'  # Optional: include charts
)
```

### Without Charts

```python
# Generate PDF without embedded charts (faster, smaller file)
results.generate_pdf_report(
    output_path='./output/my_report.pdf',
    chart_dir=None
)
```

## Installation

PDF generation requires the ReportLab library:

```bash
pip install reportlab
```

This is included in the `requirements.txt` file.

## File Size

Typical PDF report sizes:
- **Without charts**: ~10-20 KB (metrics and tables only)
- **With charts**: ~200-500 KB (includes 7 embedded high-quality PNG images)

## Use Cases

PDF reports are ideal for:

1. **Client Presentations**
   - Professional appearance
   - Standalone document (no external dependencies)
   - Easy to email and share

2. **Investment Committee Reports**
   - Comprehensive metrics in one document
   - Visual charts for quick understanding
   - Detailed statistics for deep analysis

3. **Strategy Documentation**
   - Archive backtest results
   - Document strategy performance
   - Regulatory compliance

4. **Comparative Analysis**
   - Generate multiple PDFs for different strategies
   - Side-by-side comparison
   - Consistent formatting across reports

## Customization

The PDF report is generated by the `ReportGenerator` class in `backtesting/report_generator.py`.

To customize:

1. **Colors**: Modify hex color codes in the `generate_pdf_report()` method
2. **Sections**: Add or remove sections in the report structure
3. **Metrics**: Filter or organize metrics differently
4. **Layout**: Adjust table widths, spacing, and margins

Example customization:

```python
from backtesting.report_generator import ReportGenerator

# Create custom generator
generator = ReportGenerator()

# Generate with custom metrics selection
selected_metrics = {
    k: v for k, v in metrics.items()
    if k in ['total_return', 'sharpe_ratio', 'max_drawdown']
}

generator.generate_pdf_report(
    metrics=selected_metrics,
    dates=results.dates,
    portfolio_values=results.portfolio_values,
    daily_pnl=results.daily_pnl,
    daily_returns=results.daily_returns,
    gross_exposures=results.gross_exposures,
    net_exposures=results.net_exposures,
    transaction_costs=results.transaction_costs,
    chart_dir='./output/charts',
    output_path='./output/custom_report.pdf'
)
```

## Example Output

When you run:

```bash
python test_pdf_report.py
```

You'll get output like:

```
============================================================
GENERATING PDF REPORT
============================================================

Generating reports in output/pdf_test...
Generating charts...
Charts saved to output/pdf_test/charts
PDF report saved to output/pdf_test/backtest_report.pdf
HTML report saved to output/pdf_test/backtest_report.html
Excel report saved to output/pdf_test/backtest_report.xlsx
Reports generated successfully in output/pdf_test

============================================================
PDF REPORT TEST COMPLETE!
============================================================

Check the following files:
  PDF Report:   output/pdf_test/backtest_report.pdf
  HTML Report:  output/pdf_test/backtest_report.html
  Excel Report: output/pdf_test/backtest_report.xlsx
  Charts:       output/pdf_test/charts/
```

## Troubleshooting

### ReportLab Not Installed

If you see:
```
Warning: reportlab not installed. Install with: pip install reportlab
```

Solution:
```bash
pip install reportlab
```

### Charts Not Appearing

If charts are not embedded in the PDF:

1. Check that `chart_dir` parameter is correct
2. Ensure charts were generated first: `results.generate_charts('./output/charts')`
3. Verify chart files exist: `ls ./output/charts/*.png`

### PDF File Size Too Large

If PDF is too large:

1. Generate without charts: `chart_dir=None`
2. Reduce chart resolution in `visualization.py` (change `dpi` parameter)
3. Generate charts as JPG instead of PNG (modify `BacktestVisualizer`)

### Formatting Issues

If tables don't fit or text is cut off:

1. Adjust column widths in `report_generator.py`
2. Change page size from `letter` to `A4` if needed
3. Reduce font sizes for tables

## Technical Details

### Dependencies

- **reportlab**: PDF generation library
- **matplotlib**: Chart generation (converted to images)
- **pandas**: Data handling
- **numpy**: Statistical calculations

### Implementation

PDF generation uses:
- `SimpleDocTemplate`: Document structure
- `Table` and `TableStyle`: Formatted tables
- `Paragraph` and `ParagraphStyle`: Text formatting
- `Image`: Embedded charts
- `Spacer` and `PageBreak`: Layout control

### Performance

- PDF generation is fast: typically <1 second for reports with charts
- Memory efficient: charts are loaded as files, not kept in memory
- No external dependencies once PDF is created

## Next Steps

1. Try the test script: `python test_pdf_report.py`
2. Open the generated PDF: `open output/pdf_test/backtest_report.pdf`
3. Customize colors and layout to match your branding
4. Integrate PDF generation into your workflow

## Examples

See the following notebooks for PDF generation examples:

- [01_basic_setup_and_data_loading.ipynb](notebooks/01_basic_setup_and_data_loading.ipynb)
- [02_signal_based_trading.ipynb](notebooks/02_signal_based_trading.ipynb)
- [03_use_case_1_target_positions.ipynb](notebooks/03_use_case_1_target_positions.ipynb)
- [04_use_case_3_risk_managed_portfolio.ipynb](notebooks/04_use_case_3_risk_managed_portfolio.ipynb)

All notebooks now include PDF report generation by default.
